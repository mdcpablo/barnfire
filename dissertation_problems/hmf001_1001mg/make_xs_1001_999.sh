#! /usr/bin/env bash 
# Pablo Vaquer, Summer Internship 2018 

############################ 
# INITIALIZE VARIABLES 
############################ 

## !!!!! 
# You need to set and export the following: 
# export SCRATCH_BARN=... 
# export ENDF=... 
# export NJOY=... 
## !!!!! 

# This is a resolution parameter used in indicators.py only. I usually just set it at 9.
res=9 

# This is the minimum bin width for a single sublement (use 1e-4 to avoid seg faulting in ERRORR)
bin=1.00e-16 

# In addition to coarse groups, I use energy penalties. 
# See my dissertation, Appendix B, section 1 for more details 
penalty=0 

# Which problem to run, materials-wise. 
# This is only used in indicators.py and indicators_clustering.py, 
# where there is a mapping from this string to a set of materials defined in 
# materials_materials.py. 
unimportantMatsExist=0 
m=HMF001 

# The specific list of materials to generate NJOY inputs for / read NJOY outputs from  
# This is only used in calls to materials.py 
mUNIMPORTANTlist=()  

# We need PENDF files for all the materials to do the clustering, 
# but we can only do half of the materials at a time due to incompatible 
# thermal treatments  
mIMPORTANTlist=(HMF001 )  

# How many elements to use in the resolved resonance region (RRR). 
g=999 

# These are the coarse-group boundaries in eV. c also specifies the extent of the RRR 
c=(1.0000000000e-03 1.0236612987e-03 1.0478824544e-03 1.0726767141e-03 1.0980576382e-03 1.1240391079e-03 1.1506353329e-03 1.1778608592e-03 1.2057305768e-03 1.2342597281e-03 1.2634639161e-03 1.2933591132e-03 1.3239616694e-03 1.3552883219e-03 1.3873562036e-03 1.4201828531e-03 1.4537862238e-03 1.4881846938e-03 1.5233970763e-03 1.5594426295e-03 1.5963410673e-03 1.6341125700e-03 1.6727777956e-03 1.7123578906e-03 1.7528745021e-03 1.7943497892e-03 1.8368064355e-03 1.8802676611e-03 1.9247572358e-03 1.9702994916e-03 2.0169193363e-03 2.0646422671e-03 2.1134943844e-03 2.1635024063e-03 2.2146936828e-03 2.2670962115e-03 2.3207386521e-03 2.3756503424e-03 2.4318613147e-03 2.4894023116e-03 2.5483048031e-03 2.6086010042e-03 2.6703238916e-03 2.7335072227e-03 2.7981855535e-03 2.8643942576e-03 2.9321695456e-03 3.0015484849e-03 3.0725690201e-03 3.1452699933e-03 3.2196911660e-03 3.2958732403e-03 3.3738578813e-03 3.4536877403e-03 3.5354064774e-03 3.6190587859e-03 3.7046904167e-03 3.7923482031e-03 3.8820800866e-03 3.9739351429e-03 4.0679636092e-03 4.1642169111e-03 4.2627476911e-03 4.3636098374e-03 4.4668585130e-03 4.5725501863e-03 4.6807426619e-03 4.7914951120e-03 4.9048681088e-03 5.0209236580e-03 5.1397252323e-03 5.2613378060e-03 5.3858278912e-03 5.5132635735e-03 5.6437145495e-03 5.7772521650e-03 5.9139494539e-03 6.0538811782e-03 6.1971238688e-03 6.3437558674e-03 6.4938573697e-03 6.6475104683e-03 6.8047991989e-03 6.9658095850e-03 7.1306296860e-03 7.2993496447e-03 7.4720617366e-03 7.6488604210e-03 7.8298423918e-03 8.0151066311e-03 8.2047544629e-03 8.3988896086e-03 8.5976182441e-03 8.8010490571e-03 9.0092933074e-03 9.2224648870e-03 9.4406803831e-03 9.6640591412e-03 9.8927233308e-03 1.0126798012e-02 1.0366411204e-02 1.0611693956e-02 1.0862780416e-02 1.1119807908e-02 1.1382917003e-02 1.1652251602e-02 1.1927959008e-02 1.2210190008e-02 1.2499098960e-02 1.2794843874e-02 1.3097586496e-02 1.3407492402e-02 1.3724731084e-02 1.4049476045e-02 1.4381904894e-02 1.4722199441e-02 1.5070545799e-02 1.5427134484e-02 1.5792160520e-02 1.6165823547e-02 1.6548327926e-02 1.6939882855e-02 1.7340702483e-02 1.7751006023e-02 1.8171017878e-02 1.8600967759e-02 1.9041090813e-02 1.9491627749e-02 1.9952824975e-02 2.0424934726e-02 2.0908215206e-02 2.1402930731e-02 2.1909351867e-02 2.2427755585e-02 2.2958425408e-02 2.3501651568e-02 2.4057731165e-02 2.4626968327e-02 2.5209674380e-02 2.5806168015e-02 2.6416775463e-02 2.7041830677e-02 2.7681675509e-02 2.8336659901e-02 2.9007142074e-02 2.9693488725e-02 3.0396075230e-02 3.1115285844e-02 3.1851513916e-02 3.2605162099e-02 3.3376642578e-02 3.4166377286e-02 3.4974798143e-02 3.5802347287e-02 3.6649477319e-02 3.7516651548e-02 3.8404344245e-02 3.9313040904e-02 4.0243238506e-02 4.1195445791e-02 4.2170183537e-02 4.3167984845e-02 4.4189395427e-02 4.5234973909e-02 4.6305292137e-02 4.7400935484e-02 4.8522503175e-02 4.9670608614e-02 5.0845879719e-02 5.2048959265e-02 5.3280505235e-02 5.4541191182e-02 5.5831706596e-02 5.7152757280e-02 5.8505065739e-02 5.9889371573e-02 6.1306431880e-02 6.2757021675e-02 6.4241934308e-02 6.5761981902e-02 6.7317995796e-02 6.8910827000e-02 7.0541346658e-02 7.2210446529e-02 7.3919039471e-02 7.5668059941e-02 7.7458464506e-02 7.9291232368e-02 8.1167365898e-02 8.3087891184e-02 8.5053858593e-02 8.7066343343e-02 8.9126446096e-02 9.1235293556e-02 9.3394039085e-02 9.5603863336e-02 9.7865974900e-02 1.0018161096e-01 1.0255203798e-01 1.0497855238e-01 1.0746248126e-01 1.1000518312e-01 1.1260804861e-01 1.1527250128e-01 1.1799999836e-01 1.2079203157e-01 1.2365012790e-01 1.2657585051e-01 1.2957079951e-01 1.3263661289e-01 1.3577496740e-01 1.3898757946e-01 1.4227620609e-01 1.4564264589e-01 1.4908874003e-01 1.5261637324e-01 1.5622747482e-01 1.5992401976e-01 1.6370802976e-01 1.6758157434e-01 1.7154677202e-01 1.7560579143e-01 1.7976085251e-01 1.8401422773e-01 1.8836824333e-01 1.9282528059e-01 1.9738777714e-01 2.0205822829e-01 2.0683918838e-01 2.1173327219e-01 2.1674315638e-01 2.2187158093e-01 2.2712135067e-01 2.3249533678e-01 2.3799647838e-01 2.4362778414e-01 2.4939233390e-01 2.5529328040e-01 2.6133385095e-01 2.6751734925e-01 2.7384715714e-01 2.8032673652e-01 2.8695963115e-01 2.9374946869e-01 3.0069996260e-01 3.0781491422e-01 3.1509821484e-01 3.2255384780e-01 3.3018589073e-01 3.3799851770e-01 3.4599600158e-01 3.5418271631e-01 3.6256313934e-01 3.7114185406e-01 3.7992355231e-01 3.8891303695e-01 3.9811522447e-01 4.0753514770e-01 4.1717795854e-01 4.2704893082e-01 4.3715346311e-01 4.4749708176e-01 4.5808544386e-01 4.6892434036e-01 4.8001969923e-01 4.9137758869e-01 5.0300422057e-01 5.1490595366e-01 5.2708929721e-01 5.3956091450e-01 5.5232762644e-01 5.6539641537e-01 5.7877442881e-01 5.9246898343e-01 6.0648756899e-01 6.2083785249e-01 6.3552768234e-01 6.5056509264e-01 6.6595830759e-01 6.8171574601e-01 6.9784602587e-01 7.1435796911e-01 7.3126060637e-01 7.4856318197e-01 7.6627515899e-01 7.8440622438e-01 8.0296629432e-01 8.2196551963e-01 8.4141429127e-01 8.6132324612e-01 8.8170327269e-01 9.0256551715e-01 9.2392138941e-01 9.4578256934e-01 9.6816101318e-01 9.9106896007e-01 1.0145189387e+00 1.0385237743e+00 1.0630965955e+00 1.0882508416e+00 1.1140002697e+00 1.1403589628e+00 1.1673413368e+00 1.1949621488e+00 1.2232365051e+00 1.2521798694e+00 1.2818080713e+00 1.3121373149e+00 1.3431841878e+00 1.3749656700e+00 1.4074991434e+00 1.4408024009e+00 1.4748936569e+00 1.5097915562e+00 1.5455151851e+00 1.5820840815e+00 1.6195182454e+00 1.6578381503e+00 1.6970647539e+00 1.7372195099e+00 1.7783243796e+00 1.8204018438e+00 1.8634749155e+00 1.9075671521e+00 1.9527026682e+00 1.9989061492e+00 2.0462028646e+00 2.0946186817e+00 2.1441800799e+00 2.1949141651e+00 2.2468486847e+00 2.3000120425e+00 2.3544333144e+00 2.4101422642e+00 2.4671693601e+00 2.5255457912e+00 2.5853034844e+00 2.6464751223e+00 2.7090941606e+00 2.7731948466e+00 2.8388122381e+00 2.9059822223e+00 2.9747415356e+00 3.0451277835e+00 3.1171794614e+00 3.1909359756e+00 3.2664376647e+00 3.3437258219e+00 3.4228427172e+00 3.5038316210e+00 3.5867368274e+00 3.6716036787e+00 3.7584785899e+00 3.8474090743e+00 3.9384437695e+00 4.0316324638e+00 4.1270261236e+00 4.2246769213e+00 4.3246382637e+00 4.4269648212e+00 4.5317125580e+00 4.6389387623e+00 4.7487020778e+00 4.8610625359e+00 4.9760815884e+00 5.0938221410e+00 5.2143485880e+00 5.3377268472e+00 5.4640243963e+00 5.5933103094e+00 5.7256552952e+00 5.8611317351e+00 5.9998137236e+00 6.1417771080e+00 6.2870995305e+00 6.4358604702e+00 6.5881412869e+00 6.7440252655e+00 6.9035976615e+00 7.0669457476e+00 7.2341588615e+00 7.4053284549e+00 7.5805481431e+00 7.7599137567e+00 7.9435233937e+00 8.1314774731e+00 8.3238787902e+00 8.5208325722e+00 8.7224465365e+00 8.9288309491e+00 9.1400986849e+00 9.3563652896e+00 9.5777490431e+00 9.8043710237e+00 1.0036355175e+01 1.0273828372e+01 1.0516920493e+01 1.0765764490e+01 1.1020496459e+01 1.1281255717e+01 1.1548184878e+01 1.1821429929e+01 1.2101140313e+01 1.2387469009e+01 1.2680572612e+01 1.2980611428e+01 1.3287749552e+01 1.3602154963e+01 1.3923999614e+01 1.4253459527e+01 1.4590714890e+01 1.4935950152e+01 1.5289354130e+01 1.5651120104e+01 1.6021445931e+01 1.6400534148e+01 1.6788592085e+01 1.7185831976e+01 1.7592471080e+01 1.8008731792e+01 1.8434841773e+01 1.8871034070e+01 1.9317547243e+01 1.9774625498e+01 2.0242518818e+01 2.0721483101e+01 2.1211780302e+01 2.1713678570e+01 2.2227452404e+01 2.2753382794e+01 2.3291757380e+01 2.3842870607e+01 2.4407023890e+01 2.4984525771e+01 2.5575692098e+01 2.6180846187e+01 2.6800319007e+01 2.7434449360e+01 2.8083584060e+01 2.8748078129e+01 2.9428294992e+01 3.0124606669e+01 3.0837393984e+01 3.1567046773e+01 3.2313964095e+01 3.3078554450e+01 3.3861236006e+01 3.4662436824e+01 3.5482595094e+01 3.6322159374e+01 3.7181588835e+01 3.8061353513e+01 3.8961934566e+01 3.9883824536e+01 4.0827527620e+01 4.1793559944e+01 4.2782449848e+01 4.3794738171e+01 4.4830978551e+01 4.5891737724e+01 4.6977595836e+01 4.8089146761e+01 4.9226998425e+01 5.0391773137e+01 5.1584107931e+01 5.2804654915e+01 5.4054081626e+01 5.5333071395e+01 5.6642323723e+01 5.7982554661e+01 5.9354497204e+01 6.0758901689e+01 6.2196536208e+01 6.3668187027e+01 6.5174659015e+01 6.6716776087e+01 6.8295381652e+01 6.9911339074e+01 7.1565532148e+01 7.3258865578e+01 7.4992265476e+01 7.6766679866e+01 7.8583079206e+01 8.0442456912e+01 8.2345829910e+01 8.4294239185e+01 8.6288750354e+01 8.8330454247e+01 9.0420467506e+01 9.2559933192e+01 9.4750021415e+01 9.6991929970e+01 9.9286884993e+01 1.0163614163e+02 1.0404098473e+02 1.0650272955e+02 1.0902272244e+02 1.1160234163e+02 1.1424299797e+02 1.1694613567e+02 1.1971323311e+02 1.2254580367e+02 1.2544539653e+02 1.2841359752e+02 1.3145203001e+02 1.3456235575e+02 1.3774627584e+02 1.4100553161e+02 1.4434190560e+02 1.4775722254e+02 1.5125335031e+02 1.5483220101e+02 1.5849573196e+02 1.6224594681e+02 1.6608489661e+02 1.7001468095e+02 1.7403744910e+02 1.7815540116e+02 1.8237078931e+02 1.8668591902e+02 1.9110315031e+02 1.9562489902e+02 2.0025363818e+02 2.0499189933e+02 2.0984227388e+02 2.1480741459e+02 2.1989003698e+02 2.2509292082e+02 2.3041891165e+02 2.3587092233e+02 2.4145193467e+02 2.4716500101e+02 2.5301324591e+02 2.5899986789e+02 2.6512814112e+02 2.7140141725e+02 2.7782312724e+02 2.8439678323e+02 2.9112598045e+02 2.9801439922e+02 3.0506580693e+02 3.1228406010e+02 3.1967310651e+02 3.2723698736e+02 3.3497983945e+02 3.4290589747e+02 3.5101949632e+02 3.5932507346e+02 3.6782717134e+02 3.7653043990e+02 3.8543963909e+02 3.9455964151e+02 4.0389543502e+02 4.1345212554e+02 4.2323493976e+02 4.3324922807e+02 4.4350046745e+02 4.5399426447e+02 4.6473635835e+02 4.7573262412e+02 4.8698907583e+02 4.9851186979e+02 5.1030730803e+02 5.2238184165e+02 5.3474207442e+02 5.4739476635e+02 5.6034683740e+02 5.7360537128e+02 5.8717761928e+02 6.0107100429e+02 6.1529312484e+02 6.2985175923e+02 6.4475486982e+02 6.6001060736e+02 6.7562731546e+02 6.9161353515e+02 7.0797800956e+02 7.2472968869e+02 7.4187773430e+02 7.5943152494e+02 7.7740066106e+02 7.9579497028e+02 8.1462451275e+02 8.3389958664e+02 8.5363073381e+02 8.7382874555e+02 8.9450466847e+02 9.1566981059e+02 9.3733574745e+02 9.5951432851e+02 9.8221768361e+02 1.0054582296e+03 1.0292486770e+03 1.0536020374e+03 1.0785316298e+03 1.1040510889e+03 1.1301743714e+03 1.1569157647e+03 1.1842898942e+03 1.2123117311e+03 1.2409966010e+03 1.2703601922e+03 1.3004185641e+03 1.3311881562e+03 1.3626857967e+03 1.3949287123e+03 1.4279345372e+03 1.4617213227e+03 1.4963075475e+03 1.5317121273e+03 1.5679544254e+03 1.6050542633e+03 1.6430319316e+03 1.6819082008e+03 1.7217043331e+03 1.7624420935e+03 1.8041437623e+03 1.8468321467e+03 1.8905305937e+03 1.9352630027e+03 1.9810538385e+03 2.0279281451e+03 2.0759115586e+03 2.1250303220e+03 2.1753112991e+03 2.2267819894e+03 2.2794705431e+03 2.3334057764e+03 2.3886171874e+03 2.4451349720e+03 2.5029900409e+03 2.5622140358e+03 2.6228393473e+03 2.6848991324e+03 2.7484273327e+03 2.8134586926e+03 2.8800287790e+03 2.9481740001e+03 3.0179316256e+03 3.0893398072e+03 3.1624375990e+03 3.2372649795e+03 3.3138628730e+03 3.3922731722e+03 3.4725387609e+03 3.5547035376e+03 3.6388124396e+03 3.7249114675e+03 3.8130477102e+03 3.9032693709e+03 3.9956257933e+03 4.0901674885e+03 4.1869461630e+03 4.2860147466e+03 4.3874274216e+03 4.4912396522e+03 4.5975082149e+03 4.7062912299e+03 4.8176481923e+03 4.9316400050e+03 5.0483290120e+03 5.1677790325e+03 5.2900553956e+03 5.4152249763e+03 5.5433562317e+03 5.6745192391e+03 5.8087857336e+03 5.9462291477e+03 6.0869246514e+03 6.2309491935e+03 6.3783815433e+03 6.5293023340e+03 6.6837941065e+03 6.8419413551e+03 7.0038305729e+03 7.1695502998e+03 7.3391911707e+03 7.5128459649e+03 7.6906096571e+03 7.8725794691e+03 8.0588549231e+03 8.2495378963e+03 8.4447326763e+03 8.6445460182e+03 8.8490872033e+03 9.0584680985e+03 9.2728032176e+03 9.4922097839e+03 9.7168077946e+03 9.9467200858e+03 1.0182072400e+04 1.0422993457e+04 1.0669615018e+04 1.0922071965e+04 1.1180502372e+04 1.1445047578e+04 1.1715852267e+04 1.1993064546e+04 1.2276836028e+04 1.2567321912e+04 1.2864681069e+04 1.3169076130e+04 1.3480673573e+04 1.3799643817e+04 1.4126161311e+04 1.4460404632e+04 1.4802556585e+04 1.5152804297e+04 1.5511339325e+04 1.5878357758e+04 1.6254060323e+04 1.6638652499e+04 1.7032344625e+04 1.7435352018e+04 1.7847895089e+04 1.8270199465e+04 1.8702496111e+04 1.9145021458e+04 1.9598017528e+04 2.0061732074e+04 2.0536418708e+04 2.1022337045e+04 2.1519752840e+04 2.2028938139e+04 2.2550171424e+04 2.3083737764e+04 2.3629928978e+04 2.4189043785e+04 2.4761387974e+04 2.5347274570e+04 2.5947024004e+04 2.6560964288e+04 2.7189431197e+04 2.7832768449e+04 2.8491327896e+04 2.9165469714e+04 2.9855562604e+04 3.0561983987e+04 3.1285120218e+04 3.2025366791e+04 3.2783128559e+04 3.3558819955e+04 3.4352865217e+04 3.5165698620e+04 3.5997764718e+04 3.6849518580e+04 3.7721426045e+04 3.8613963972e+04 3.9527620506e+04 4.0462895340e+04 4.1420299991e+04 4.2400358080e+04 4.3403605616e+04 4.4430591291e+04 4.5481876782e+04 4.6558037052e+04 4.7659660671e+04 4.8787350136e+04 4.9941722199e+04 5.1123408203e+04 5.2333054433e+04 5.3571322464e+04 5.4838889525e+04 5.6136448868e+04 5.7464710150e+04 5.8824399819e+04 6.0216261512e+04 6.1641056460e+04 6.3099563906e+04 6.4592581533e+04 6.6120925896e+04 6.7685432871e+04 6.9286958113e+04 7.0926377523e+04 7.2604587724e+04 7.4322506558e+04 7.6081073583e+04 7.7881250587e+04 7.9724022117e+04 8.1610396015e+04 8.3541403969e+04 8.5518102079e+04 8.7541571433e+04 8.9612918700e+04 9.1733276733e+04 9.3903805191e+04 9.6125691170e+04 9.8400149858e+04 1.0072842519e+05 1.0311179054e+05 1.0555154942e+05 1.0804903615e+05 1.1060561666e+05 1.1322268919e+05 1.1590168506e+05 1.1864406944e+05 1.2145134220e+05 1.2432503868e+05 1.2726673056e+05 1.3027802668e+05 1.3336057398e+05 1.3651605835e+05 1.3974620557e+05 1.4305278228e+05 1.4643759689e+05 1.4990250060e+05 1.5344938844e+05 1.5708020025e+05 1.6079692178e+05 1.6460158577e+05 1.6849627305e+05 1.7248311369e+05 1.7656428815e+05 1.8074202851e+05 1.8501861963e+05 1.8939640044e+05 1.9387776524e+05 1.9846516495e+05 2.0316110849e+05 2.0796816415e+05 2.1288896099e+05 2.1792619028e+05 2.2308260696e+05 2.2836103114e+05 2.3376434970e+05 2.3929551780e+05 2.4495756051e+05 2.5075357451e+05 2.5668672973e+05 2.6276027110e+05 2.6897752035e+05 2.7534187779e+05 2.8185682420e+05 2.8852592270e+05 2.9535282072e+05 3.0234125202e+05 3.0949503869e+05 3.1681809323e+05 3.2431442075e+05 3.3198812112e+05 3.3984339121e+05 3.4788452719e+05 3.5611592688e+05 3.6454209219e+05 3.7316763150e+05 3.8199726228e+05 3.9103581359e+05 4.0028822876e+05 4.0975956809e+05 4.1945501161e+05 4.2937986192e+05 4.3953954707e+05 4.4993962357e+05 4.6058577938e+05 4.7148383706e+05 4.8263975694e+05 4.9405964038e+05 5.0574973308e+05 5.1771642857e+05 5.2996627160e+05 5.4250596183e+05 5.5534235742e+05 5.6848247880e+05 5.8193351251e+05 5.9570281515e+05 6.0979791737e+05 6.2422652802e+05 6.3899653833e+05 6.5411602627e+05 6.6959326092e+05 6.8543670705e+05 7.0165502969e+05 7.1825709890e+05 7.3525199463e+05 7.5264901167e+05 7.7045766472e+05 7.8868769363e+05 8.0734906870e+05 8.2645199613e+05 8.4600692364e+05 8.6602454613e+05 8.8651581156e+05 9.0749192695e+05 9.2896436446e+05 9.5094486773e+05 9.7344545826e+05 9.9647844197e+05 1.0200564160e+06 1.0441922755e+06 1.0688992208e+06 1.0941907645e+06 1.1200807390e+06 1.1465833038e+06 1.1737129538e+06 1.2014845266e+06 1.2299132108e+06 1.2590145546e+06 1.2888044740e+06 1.3192992616e+06 1.3505155954e+06 1.3824705483e+06 1.4151815968e+06 1.4486666312e+06 1.4829439650e+06 1.5180323451e+06 1.5539509618e+06 1.5907194596e+06 1.6283579478e+06 1.6668870115e+06 1.7063277230e+06 1.7467016528e+06 1.7880308823e+06 1.8303380150e+06 1.8736461894e+06 1.9179790915e+06 1.9633609676e+06 2.0098166378e+06 2.0573715096e+06 2.1060515913e+06 2.1558835070e+06 2.2068945105e+06 2.2591125007e+06 2.3125660362e+06 2.3672843519e+06 2.4232973740e+06 2.4806357369e+06 2.5393307999e+06 2.5994146643e+06 2.6609201911e+06 2.7238810184e+06 2.7883315807e+06 2.8543071270e+06 2.9218437404e+06 2.9909783578e+06 3.0617487900e+06 3.1341937425e+06 3.2083528367e+06 3.2842666314e+06 3.3619766450e+06 3.4415253785e+06 3.5229563383e+06 3.6063140604e+06 3.6916441345e+06 3.7789932289e+06 3.8684091163e+06 3.9599406997e+06 4.0536380393e+06 4.1495523796e+06 4.2477361778e+06 4.3482431321e+06 4.4511282115e+06 4.5564476855e+06 4.6642591550e+06 4.7746215839e+06 4.8875953312e+06 5.0032421840e+06 5.1216253916e+06 5.2428096996e+06 5.3668613857e+06 5.4938482959e+06 5.6238398812e+06 5.7569072362e+06 5.8931231377e+06 6.0325620843e+06 6.1753003374e+06 6.3214159630e+06 6.4709888741e+06 6.6241008745e+06 6.7808357036e+06 6.9412790824e+06 7.1055187598e+06 7.2736445613e+06 7.4457484376e+06 7.6219245152e+06 7.8022691475e+06 7.9868809680e+06 8.1758609439e+06 8.3693124315e+06 8.5673412325e+06 8.7700556522e+06 8.9775665582e+06 9.1899874418e+06 9.4074344793e+06 9.6300265962e+06 9.8578855315e+06 1.0091135905e+07 1.0329905286e+07 1.0574324260e+07 1.0824526504e+07 1.1080648859e+07 1.1342831401e+07 1.1611217522e+07 1.1885954008e+07 1.2167191115e+07 1.2455082658e+07 1.2749786089e+07 1.3051462585e+07 1.3360277139e+07 1.3676398647e+07 1.4000000000e+07 ) 

# The group structure to use outside the RRR in the thermal and fast energy ranges. 
# G=shem-361 would point to ../dat/energy_groups/shem-361.txt 
G=log-1-999-1 
 
# How many Legendre moments to use for the scattering transfer matrices 
L=7 

# Which clustering algorithm to use. Recommended: use 'tmg' for MG XS and 'har' for FEDS XS 
# Use './indicators_clustering.py -h' for more information. 
clusterer=har 

# Which apportioning algorithm to use. Recommended: use 'var' for FEDS and 'L1' or 'max' for MG XS 
# Use './indicators_clustering.py -h' for more information. 
appt=equal 
 
# Which reactions to include in the PDT XS file. Recommended: use 'abs' if absorption edits are needed 
# Use './materials.py -h' for more information 
rxnOpt=invel 

# Use './materials.py -h' for more information 
weightOpt=(2) 
#weightOpt=(4 .1265 .0253 .1265 1.4e6) 
 
############################ 
# GENERATE CROSS SECTIONS 
############################ 
 
#NB: In many cases, if a previous step has run successfully, you don't need 
# to rerun it to run a later step if you make changes that affect that later 
# step only. 
echo '                  (         )   (      (      (           ' 
echo '   (      (       )\ )   ( /(   )\ )   )\ )   )\ )        ' 
echo ' ( )\     )\     (()/(   )\()) (()/(  (()/(  (()/(   (    ' 
echo ' )((_) ((((_)(    /(_)) ((_)\   /(_))  /(_))  /(_))  )\   ' 
echo '((_)_   )\ _ )\  (_))    _((_) (_))_| (_))   (_))   ((_)  ' 
echo ' | _ )  (_)_\(_) | _ \  | \| | | |_   |_ _|  | _ \  | __| ' 
echo ' | _ \   / _ \   |   /  | .` | | __|   | |   |   /  | _|  ' 
echo ' |___/  /_/ \_\  |_|_\  |_|\_| |_|    |___|  |_|_\  |___| ' 
echo 
echo '------- Step 0: Initializing the scratch directory -------' 
scriptdir=`pwd` 
srcdir=/home/pablo/barnfire/src 
cd $srcdir
./Initialize.py $scriptdir $0 
 
echo '------- Step 1: Generating the NJOY inputs -------' 
mList=${mIMPORTANTlist[*]} 
./materials.py -m ${mList[*]} -W ${weightOpt[*]} -v 
 
echo '------- Step 2: Running NJOY to generate the PENDF file -------' 
#cd $SCRATCH_BARN/xs 
#./RunPendf.sh 
#cd $srcdir 
 
if [ "${unimportantMatsExist}" = 1 ] 
then 
    echo '------- Step 1: Generating the NJOY inputs -------'  
    mList=${mUNIMPORTANTlist[*]} 
    ./materials.py -m ${mList[*]} -W ${weightOpt[*]} -v  
      
    echo '------- Step 2: Running NJOY to generate the PENDF files -------'  
#    cd $SCRATCH_BARN/xs 
#    ./RunPendf.sh  
#    cd $srcdir  
fi 
 
echo '------- Step 3: Generating the indicators and their energy grid -------' 
./indicators.py -R ${c[0]} ${c[*]: -1} -m $m -w flux -r $res -G $G -v -Z -s $bin 
 
echo '------- Step 4: Generating more indicators on the same energy grid but using escape XS -------' 
./indicators.py -R ${c[0]} ${c[*]: -1} -m $m -w sigt -r $res -G $G -v -Z -s $bin
 
echo '------- Step 5: Clustering the indicators to get the clust file, which specifies the energy mesh -------' 
./indicators_clustering.py -c ${c[*]} -e $g -m $m -w $clusterer -E $penalty -r $res -a $appt -v 3 -d 500 -S -p none  
 
echo '------- Step 6: Generating the weighting spectrum on the subelements -------' 
./indicators.py -R ${c[0]} ${c[*]: -1} -m $m -w wgt -r $res -G $G -v -Z -s $bin -M clust-$g-$res 
 
# Do for important materials: 
mList=${mIMPORTANTlist[*]} 
echo '------- Step 7: Regenerating NJOY inputs with a group structure of the subelements -------'  
./materials.py -m ${mList[*]} -G clust-$g-$res -L $L -W ${weightOpt[*]} -v  
echo '------- Step 8: Running NJOY to generate GENDF files (on the subelements) -------'  
cd $SCRATCH_BARN/xs 
./RunGendf.sh 
echo '------- Step 9: Summing/averaging over the subelements to get PDT-formatted FEDS XS on the elements -------'  
cd $srcdir 
./materials.py -b -m ${mList[*]} -p $rxnOpt -M clust-$g-$res -W ${weightOpt[*]} -v 
 
if [ "${unimportantMatsExist}" = 1 ] 
then 
    # Do for unimportant materials: 
    mList=${mUNIMPORTANTlist[*]} 
    echo '------- Step 7: Regenerating NJOY inputs with a group structure of the subelements -------'  
    ./materials.py -m ${mList[*]} -G clust-$g-$res -L $L -W ${weightOpt[*]} -v  
    echo '------- Step 8: Running NJOY to generate GENDF files (on the subelements) -------'  
    cd $SCRATCH_BARN/xs 
    ./RunGendf.sh 
    echo '------- Step 9: Summing/averaging over the subelements to get PDT-formatted FEDS XS on the elements -------'  
    cd $srcdir 
    ./materials.py -b -m ${mList[*]} -p $rxnOpt -M clust-$g-$res -W ${weightOpt[*]} -v 2 
fi 
 
echo ' The result should be a list of .data files in $scratch/xs/pdtxs ' 
 
####################### 
sleep 0.1 
 
cp $SCRATCH_BARN/xs/pdtxs/BarnfireXS_HMF001_1001.xml $scriptdir/hmf001_1001mg/. 
cp $SCRATCH_BARN/dat/indicators/flux.xml $scriptdir/hmf001_1001mg/flux_1th_999cg_999el_1urr.xml 
cp $SCRATCH_BARN/dat/energy_groups/clust-$g-$res.xml $scriptdir/hmf001_1001mg/clust_1th_999cg_999el_1urr.xml
#######################
rm *.~ *.pyc
